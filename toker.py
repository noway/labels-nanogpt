from collections import Counter
import re
import pyphen


with open('trainingdata.txt', 'r') as f:
    text = f.read()
special_tokens = ["<|document|>"]
common_words = {"the", "and", "is", "in", "on", "at", "of", "------------------------------------------------------------------------"}

# Token patterns
token_patterns = {
    "special_token": re.compile(r"^<\|document\|>"),
    "space": re.compile(r"^\s+"),
    "number": re.compile(r"^\d+"),
    "dot": re.compile(r"^\."),
    "equals": re.compile(r"^="),
    "minus": re.compile(r"^-"),
    "plus": re.compile(r"^\+"),
    "comma": re.compile(r"^,"),
    "colon": re.compile(r"^:"),
    "underscore_slash": re.compile(r"^_/"),
    "double_asterisk": re.compile(r"^\*\*"),
    "word": re.compile(r"^(?:{})\b".format("|".join(re.escape(word) for word in common_words)))
}

def match_token(text, cursor):
    for token_type, pattern in token_patterns.items():
        match = pattern.match(text[cursor:cursor+10])
        if match:
            return match.group(), cursor + len(match.group())
    return text[cursor:cursor+2], cursor + 2

def custom_tokenize(text):
    tokens = []
    cursor = 0

    while cursor < len(text):
        token, cursor = match_token(text, cursor)
        if token:
            tokens.append(token)

    return tokens


# tokens = custom_tokenize(text)
# lowercase
text = text.lower()
text = text.replace('*ï¸âƒ£', ' ')
text = text.replace('1ï¸âƒ£', ' ')
text = text.replace('2ï¸âƒ£', ' ')
text = text.replace('3ï¸âƒ£', ' ')
text = text.replace('4ï¸âƒ£', ' ')
text = text.replace('5ï¸âƒ£', ' ')
text = text.replace('6ï¸âƒ£', ' ')
text = text.replace('7ï¸âƒ£', ' ')
text = text.replace('8ï¸âƒ£', ' ')
text = text.replace('9ï¸âƒ£', ' ')
text = text.replace('ðŸ”Ÿ', ' ')
text = text.replace('âšª', ' ')
text = text.replace('âš«', ' ')
text = text.replace('âš½', ' ')
text = text.replace('âš¾', ' ')
text = text.replace('âœ‚', ' ')
text = text.replace('âœ…', ' ')
text = text.replace('âœˆ', ' ')
text = text.replace('âœ‹', ' ')
text = text.replace('âœ', ' ')
text = text.replace('âœ¦', ' ')
text = text.replace('âœ¨', ' ')
text = text.replace('âœª', ' ')
text = text.replace('â„', ' ')
text = text.replace('âŒ', ' ')
text = text.replace('â', ' ')
text = text.replace('â¤', ' ')
text = text.replace('âž¡', ' ')
text = text.replace('â¬…', ' ')
text = text.replace('â¬œ', ' ')
text = text.replace('â¬¡', ' ')
text = text.replace('â­', ' ')
text = text.replace('ï¸', ' ')
text = text.replace('ðŸŒŸ', ' ')
text = text.replace('ðŸŒ±', ' ')
text = text.replace('ðŸŒ²', ' ')
text = text.replace('ðŸŒ³', ' ')
text = text.replace('ðŸŒ´', ' ')
text = text.replace('ðŸŒµ', ' ')
text = text.replace('ðŸŒ·', ' ')
text = text.replace('ðŸŒ¸', ' ')
text = text.replace('ðŸŒ¹', ' ')
text = text.replace('ðŸŒº', ' ')
text = text.replace('ðŸŒ»', ' ')
text = text.replace('ðŸŒ¼', ' ')
text = text.replace('ðŸŒ¾', ' ')
text = text.replace('ðŸ€', ' ')
text = text.replace('ðŸ‚', ' ')
text = text.replace('ðŸƒ', ' ')
text = text.replace('ðŸ‡', ' ')
text = text.replace('ðŸ‰', ' ')
text = text.replace('ðŸŠ', ' ')
text = text.replace('ðŸŒ', ' ')
text = text.replace('ðŸŽ', ' ')
text = text.replace('ðŸ', ' ')
text = text.replace('ðŸ', ' ')
text = text.replace('ðŸ’', ' ')
text = text.replace('ðŸ“', ' ')
text = text.replace('ðŸ•', ' ')
text = text.replace('ðŸž', ' ')
text = text.replace('ðŸ¦', ' ')
text = text.replace('ðŸ©', ' ')
text = text.replace('ðŸª', ' ')
text = text.replace('ðŸ¬', ' ')
text = text.replace('ðŸ³', ' ')
text = text.replace('ðŸ´', ' ')
text = text.replace('ðŸ½', ' ')
text = text.replace('ðŸŽˆ', ' ')
text = text.replace('ðŸŽ‰', ' ')
text = text.replace('ðŸŽ’', ' ')
text = text.replace('ðŸŽ¨', ' ')
text = text.replace('ðŸŽµ', ' ')
text = text.replace('ðŸŽ¸', ' ')
text = text.replace('ðŸ€', ' ')
text = text.replace('ðŸŽ', ' ')
text = text.replace('ðŸ˜', ' ')
text = text.replace('ðŸ ', ' ')
text = text.replace('ðŸ¡', ' ')
text = text.replace('ðŸ¢', ' ')
text = text.replace('ðŸ°', ' ')
text = text.replace('ðŸ', ' ')
text = text.replace('ðŸˆ', ' ')
text = text.replace('ðŸŒ', ' ')
text = text.replace('ðŸ˜', ' ')
text = text.replace('ðŸ™', ' ')
text = text.replace('ðŸ', ' ')
text = text.replace('ðŸŸ', ' ')
text = text.replace('ðŸ ', ' ')
text = text.replace('ðŸ¤', ' ')
text = text.replace('ðŸ¦', ' ')
text = text.replace('ðŸ­', ' ')
text = text.replace('ðŸ°', ' ')
text = text.replace('ðŸ±', ' ')
text = text.replace('ðŸ³', ' ')
text = text.replace('ðŸµ', ' ')
text = text.replace('ðŸ¶', ' ')
text = text.replace('ðŸ·', ' ')
text = text.replace('ðŸ¸', ' ')
text = text.replace('ðŸ»', ' ')
text = text.replace('ðŸ‘‰', ' ')
text = text.replace('ðŸ‘Ÿ', ' ')
text = text.replace('ðŸ‘§', ' ')
text = text.replace('ðŸ‘¨', ' ')
text = text.replace('ðŸ‘©', ' ')
text = text.replace('ðŸ’¦', ' ')
text = text.replace('ðŸ’§', ' ')
text = text.replace('ðŸ’¼', ' ')
text = text.replace('ðŸ“', ' ')
text = text.replace('ðŸ“–', ' ')
text = text.replace('ðŸ“˜', ' ')
text = text.replace('ðŸ“š', ' ')
text = text.replace('ðŸ”', ' ')
text = text.replace('ðŸ”Ž', ' ')
text = text.replace('ðŸ”Ÿ', ' ')
text = text.replace('ðŸ”¢', ' ')
text = text.replace('ðŸ”¥', ' ')
text = text.replace('ðŸ”®', ' ')
text = text.replace('ðŸ”´', ' ')
text = text.replace('ðŸ”µ', ' ')
text = text.replace('ðŸ”¶', ' ')
text = text.replace('ðŸ”º', ' ')
text = text.replace('ðŸ”¼', ' ')
text = text.replace('ðŸ•Š', ' ')
text = text.replace('ðŸ•“', ' ')
text = text.replace('ðŸ–', ' ')
text = text.replace('ðŸ–', ' ')
text = text.replace('ðŸ˜„', ' ')
text = text.replace('ðŸ˜Š', ' ')
text = text.replace('ðŸš€', ' ')
text = text.replace('ðŸšŒ', ' ')
text = text.replace('ðŸš’', ' ')
text = text.replace('ðŸš“', ' ')
text = text.replace('ðŸš•', ' ')
text = text.replace('ðŸš—', ' ')
text = text.replace('ðŸš™', ' ')
text = text.replace('ðŸš›', ' ')
text = text.replace('ðŸšœ', ' ')
text = text.replace('ðŸš§', ' ')
text = text.replace('ðŸš²', ' ')
text = text.replace('ðŸ›‘', ' ')
text = text.replace('ðŸ›´', ' ')
text = text.replace('ðŸŸ ', ' ')
text = text.replace('ðŸŸ¡', ' ')
text = text.replace('ðŸŸ¢', ' ')
text = text.replace('ðŸŸ£', ' ')
text = text.replace('ðŸŸ¥', ' ')
text = text.replace('ðŸŸ¦', ' ')
text = text.replace('ðŸŸ¨', ' ')
text = text.replace('ðŸŸ©', ' ')
text = text.replace('ðŸ¤š', ' ')
text = text.replace('ðŸ¥•', ' ')
text = text.replace('ðŸ¥š', ' ')
text = text.replace('ðŸ¥£', ' ')
text = text.replace('ðŸ¥¤', ' ')
text = text.replace('ðŸ¦†', ' ')
text = text.replace('ðŸ¦©', ' ')
text = text.replace('ðŸ§€', ' ')
text = text.replace('ðŸ§', ' ')
text = text.replace('ðŸ§’', ' ')
text = text.replace('ðŸ§¦', ' ')
text = text.replace('ðŸ§¸', ' ')
text = text.replace('ðŸª', ' ')
text = text.replace('â—', ' ')
text = text.replace('â˜€', ' ')
text = text.replace('â˜…', ' ')
text = text.replace('â˜‘', ' ')
text = text.replace('\u200d', ' ')
text = text.replace('\\<\\|image\\|\\>', ' ')
text = text.replace('\\<\\|document\\|\\>', ' ')
text = text.replace('\\<\\|unsolvedproblem\\|\\>', ' ')
text = re.sub(r'\d+', ' ', text)
text = text.replace('*', ' ')
text = text.replace('.', ' ')
text = text.replace('-', ' ')
text = text.replace('#', ' ')
text = text.replace('=', ' ')
text = text.replace('\\\n', ' ')
text = text.replace('\\ ', ' ')
text = text.replace('\\_', ' ')
text = text.replace('\\]', ' ')
text = text.replace('\\[', ' ')
text = text.replace('\\[', ' ')
text = text.replace('\\^', ' ')
text = text.replace('\\|', ' ')
text = text.replace('\\/', ' ')
text = text.replace('\\$', ' ')
text = text.replace('\\<', ' ')
text = text.replace('\\>', ' ')
text = text.replace(':', ' ')
text = text.replace('+', ' ')
text = text.replace('-', ' ')
text = text.replace('Ã·', ' ')
text = text.replace('Â·', ' ')
text = text.replace('â‹…', ' ') # TODO: same as â‹…
text = text.replace('Ã—', ' ')
text = text.replace('/', ' ')
text = text.replace(',', ' ')
text = text.replace('`', ' ')
text = text.replace('(', ' ')
text = text.replace(')', ' ')
text = text.replace('!', ' ')
text = text.replace('?', ' ')
text = text.replace('~', ' ')
text = text.replace(';', ' ')
text = text.replace('"', ' ')
text = text.replace('_', ' ')
text = text.replace('âˆ ', ' ')
text = text.replace('|', ' ')
text = text.replace('[', ' ')
text = text.replace(']', ' ')
text = text.replace('{', ' ')
text = text.replace('}', ' ')
text = text.replace('<', ' ')
text = text.replace('>', ' ')
text = text.replace('Ï€', ' ')
text = text.replace('%', ' ')
text = text.replace('&', ' ')
text = text.replace('Â¢', ' ')
text = text.replace('Â°', ' ')
text = text.replace('â€¢', ' ')
text = text.replace('^', ' ')
text = text.replace('\\', ' ')
text = text.replace('Â½', ' ') # TODO: should be 1/2
text = text.replace('Â¼', ' ') # TODO: should be 1/4
text = text.replace('Â¾', ' ') # TODO: should be 3/4
text = text.replace('â…“', ' ') # TODO: should be 1/3
text = text.replace('â†‘', ' ')
text = text.replace('â†’', ' ')
text = text.replace('â†“', ' ')
text = text.replace('â‡’', ' ')
text = text.replace('âˆš', ' ')
text = text.replace('â‰ˆ', ' ')
text = text.replace('â‰ ', ' ')
text = text.replace('â‰¤', ' ')
text = text.replace('â‰¥', ' ')
text = text.replace('â–¡', ' ')
text = text.replace('â–¢', ' ')
text = text.replace('â–³', ' ')
text = text.replace('â—‹', ' ')
text = text.replace('âˆ’', ' ') # TODO: should be -
text = text.replace('Â²', ' ')
text = text.replace('Â³', ' ')
text = text.replace('âœ“', ' ')
text = text.replace('âœ”', ' ') # TODO: same as âœ“

# replace numbers


tokens = text.split()
token_counts = Counter(tokens)
most_common_tokens = token_counts.most_common()
# most_common_tokens = [token for token, count in most_common_tokens]
# all_tokens_joined = ''.join(most_common_tokens)
# all_tokens_joined = list(all_tokens_joined)
# unique_chars = set(all_tokens_joined)
# unique_chars = sorted(unique_chars)
# print(most_common_tokens)
dic = pyphen.Pyphen(lang='en_US', left=0, right=0)
# syllables = dic.inserted('word')
# print(syllables.split('-'))

all_syllables = {}
for token, count in most_common_tokens:
    token = token.strip("'")
    syllables = dic.inserted(token)
    print (syllables, token, count)
    syllables = syllables.split('-')
    for syllable in syllables:
        if syllable not in all_syllables:
            all_syllables[syllable] = 0
        all_syllables[syllable] += count

all_syllables_items = all_syllables.items()
sorted_all_syllables_items = sorted(all_syllables_items, key=lambda x: x[1], reverse=True)
for syllable, count in sorted_all_syllables_items:
    if count < 3:
        pass